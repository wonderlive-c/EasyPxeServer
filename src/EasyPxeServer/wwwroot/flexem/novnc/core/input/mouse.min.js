/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/@flexem/novnc@1.1.6/core/input/mouse.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as Log from"../util/logging.js";import{isTouchDevice}from"../util/browser.js";import{setCapture,stopEvent,getPointerEvent}from"../util/events.js";const WHEEL_STEP=10,WHEEL_STEP_TIMEOUT=50,WHEEL_LINE_HEIGHT=19;export default class Mouse{constructor(e){this._target=e||document,this._doubleClickTimer=null,this._lastTouchPos=null,this._pos=null,this._wheelStepXTimer=null,this._wheelStepYTimer=null,this._accumulatedWheelDeltaX=0,this._accumulatedWheelDeltaY=0,this._eventHandlers={mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this)},this.touchButton=1,this.onmousebutton=()=>{},this.onmousemove=()=>{}}_resetDoubleClickTimer(){this._doubleClickTimer=null}_handleMouseButton(e,t){this._updateMousePosition(e);let s,i=this._pos;if(e.touches||e.changedTouches){if(1==t){if(null===this._doubleClickTimer)this._lastTouchPos=i;else{clearTimeout(this._doubleClickTimer);const e=this._lastTouchPos.x-i.x,t=this._lastTouchPos.y-i.y;Math.sqrt(e*e+t*t)<20*(window.devicePixelRatio||1)&&(i=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}s=this.touchButton}else s=e.which?1<<e.button:(1&e.button)+2*(2&e.button)+(4&e.button)/2;Log.Debug("onmousebutton "+(t?"down":"up")+", x: "+i.x+", y: "+i.y+", bmask: "+s),this.onmousebutton(i.x,i.y,t,s),stopEvent(e)}_handleMouseDown(e){"mousedown"===e.type&&setCapture(this._target),this._handleMouseButton(e,1)}_handleMouseUp(e){this._handleMouseButton(e,0)}_generateWheelStepX(){this._accumulatedWheelDeltaX<0?(this.onmousebutton(this._pos.x,this._pos.y,1,32),this.onmousebutton(this._pos.x,this._pos.y,0,32)):this._accumulatedWheelDeltaX>0&&(this.onmousebutton(this._pos.x,this._pos.y,1,64),this.onmousebutton(this._pos.x,this._pos.y,0,64)),this._accumulatedWheelDeltaX=0}_generateWheelStepY(){this._accumulatedWheelDeltaY<0?(this.onmousebutton(this._pos.x,this._pos.y,1,8),this.onmousebutton(this._pos.x,this._pos.y,0,8)):this._accumulatedWheelDeltaY>0&&(this.onmousebutton(this._pos.x,this._pos.y,1,16),this.onmousebutton(this._pos.x,this._pos.y,0,16)),this._accumulatedWheelDeltaY=0}_resetWheelStepTimers(){window.clearTimeout(this._wheelStepXTimer),window.clearTimeout(this._wheelStepYTimer),this._wheelStepXTimer=null,this._wheelStepYTimer=null}_handleMouseWheel(e){this._resetWheelStepTimers(),this._updateMousePosition(e);let t=e.deltaX,s=e.deltaY;0!==e.deltaMode&&(t*=19,s*=19),this._accumulatedWheelDeltaX+=t,this._accumulatedWheelDeltaY+=s,Math.abs(this._accumulatedWheelDeltaX)>10?this._generateWheelStepX():this._wheelStepXTimer=window.setTimeout(this._generateWheelStepX.bind(this),50),Math.abs(this._accumulatedWheelDeltaY)>10?this._generateWheelStepY():this._wheelStepYTimer=window.setTimeout(this._generateWheelStepY.bind(this),50),stopEvent(e)}_handleMouseMove(e){this._updateMousePosition(e),this.onmousemove(this._pos.x,this._pos.y),stopEvent(e)}_handleMouseDisable(e){e.target==this._target&&stopEvent(e)}_updateMousePosition(e){e=getPointerEvent(e);const t=this._target.getBoundingClientRect();let s,i;s=e.clientX<t.left?0:e.clientX>=t.right?t.width-1:e.clientX-t.left,i=e.clientY<t.top?0:e.clientY>=t.bottom?t.height-1:e.clientY-t.top,this._pos={x:s,y:i}}grab(){isTouchDevice&&(this._target.addEventListener("touchstart",this._eventHandlers.mousedown),this._target.addEventListener("touchend",this._eventHandlers.mouseup),this._target.addEventListener("touchmove",this._eventHandlers.mousemove)),this._target.addEventListener("mousedown",this._eventHandlers.mousedown),this._target.addEventListener("mouseup",this._eventHandlers.mouseup),this._target.addEventListener("mousemove",this._eventHandlers.mousemove),this._target.addEventListener("wheel",this._eventHandlers.mousewheel),document.addEventListener("click",this._eventHandlers.mousedisable),this._target.addEventListener("contextmenu",this._eventHandlers.mousedisable)}ungrab(){this._resetWheelStepTimers(),isTouchDevice&&(this._target.removeEventListener("touchstart",this._eventHandlers.mousedown),this._target.removeEventListener("touchend",this._eventHandlers.mouseup),this._target.removeEventListener("touchmove",this._eventHandlers.mousemove)),this._target.removeEventListener("mousedown",this._eventHandlers.mousedown),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove),this._target.removeEventListener("wheel",this._eventHandlers.mousewheel),document.removeEventListener("click",this._eventHandlers.mousedisable),this._target.removeEventListener("contextmenu",this._eventHandlers.mousedisable)}}
//# sourceMappingURL=/sm/ac7cc45588016206289e3e7a5085656b007d0d525f067d58f5ed5cb7f3ee15c1.map