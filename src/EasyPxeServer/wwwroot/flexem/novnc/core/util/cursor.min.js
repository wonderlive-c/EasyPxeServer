/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/@flexem/novnc@1.1.6/core/util/cursor.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{supportsCursorURIs,isTouchDevice}from"./browser.js";const useFallback=!supportsCursorURIs||isTouchDevice;export default class Cursor{constructor(){this._target=null,this._canvas=document.createElement("canvas"),useFallback&&(this._canvas.style.position="fixed",this._canvas.style.zIndex="65535",this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden"),this._position={x:0,y:0},this._hotSpot={x:0,y:0},this._eventHandlers={mouseover:this._handleMouseOver.bind(this),mouseleave:this._handleMouseLeave.bind(this),mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this),touchstart:this._handleTouchStart.bind(this),touchmove:this._handleTouchMove.bind(this),touchend:this._handleTouchEnd.bind(this)}}attach(t){if(this._target&&this.detach(),this._target=t,useFallback){document.body.appendChild(this._canvas);const t={capture:!0,passive:!0};this._target.addEventListener("mouseover",this._eventHandlers.mouseover,t),this._target.addEventListener("mouseleave",this._eventHandlers.mouseleave,t),this._target.addEventListener("mousemove",this._eventHandlers.mousemove,t),this._target.addEventListener("mouseup",this._eventHandlers.mouseup,t),window.addEventListener("touchstart",this._eventHandlers.touchstart,t),this._target.addEventListener("touchmove",this._eventHandlers.touchmove,t),this._target.addEventListener("touchend",this._eventHandlers.touchend,t)}this.clear()}detach(){if(this._target){if(useFallback){const t={capture:!0,passive:!0};this._target.removeEventListener("mouseover",this._eventHandlers.mouseover,t),this._target.removeEventListener("mouseleave",this._eventHandlers.mouseleave,t),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove,t),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup,t),window.removeEventListener("touchstart",this._eventHandlers.touchstart,t),this._target.removeEventListener("touchmove",this._eventHandlers.touchmove,t),this._target.removeEventListener("touchend",this._eventHandlers.touchend,t),document.body.removeChild(this._canvas)}this._target=null}}change(t,e,s,i,o){if(0===i||0===o)return void this.clear();this._position.x=this._position.x+this._hotSpot.x-e,this._position.y=this._position.y+this._hotSpot.y-s,this._hotSpot.x=e,this._hotSpot.y=s;let h,n=this._canvas.getContext("2d");this._canvas.width=i,this._canvas.height=o;try{h=new ImageData(new Uint8ClampedArray(t),i,o)}catch(e){h=n.createImageData(i,o),h.data.set(new Uint8ClampedArray(t))}if(n.clearRect(0,0,i,o),n.putImageData(h,0,0),useFallback)this._updatePosition();else{let t=this._canvas.toDataURL();this._target.style.cursor="url("+t+")"+e+" "+s+", default"}}clear(){this._target.style.cursor="none",this._canvas.width=0,this._canvas.height=0,this._position.x=this._position.x+this._hotSpot.x,this._position.y=this._position.y+this._hotSpot.y,this._hotSpot.x=0,this._hotSpot.y=0}_handleMouseOver(t){this._handleMouseMove(t)}_handleMouseLeave(t){this._updateVisibility(t.relatedTarget)}_handleMouseMove(t){this._updateVisibility(t.target),this._position.x=t.clientX-this._hotSpot.x,this._position.y=t.clientY-this._hotSpot.y,this._updatePosition()}_handleMouseUp(t){let e=document.elementFromPoint(t.clientX,t.clientY);this._updateVisibility(e),this._captureIsActive()&&window.setTimeout((()=>{e=document.elementFromPoint(t.clientX,t.clientY),this._updateVisibility(e)}),0)}_handleTouchStart(t){this._handleTouchMove(t)}_handleTouchMove(t){this._updateVisibility(t.target),this._position.x=t.changedTouches[0].clientX-this._hotSpot.x,this._position.y=t.changedTouches[0].clientY-this._hotSpot.y,this._updatePosition()}_handleTouchEnd(t){let e=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);this._updateVisibility(e)}_showCursor(){"hidden"===this._canvas.style.visibility&&(this._canvas.style.visibility="")}_hideCursor(){"hidden"!==this._canvas.style.visibility&&(this._canvas.style.visibility="hidden")}_shouldShowCursor(t){return!!t&&(t===this._target||!!this._target.contains(t)&&"none"===window.getComputedStyle(t).cursor)}_updateVisibility(t){this._captureIsActive()&&(t=document.captureElement),this._shouldShowCursor(t)?this._showCursor():this._hideCursor()}_updatePosition(){this._canvas.style.left=this._position.x+"px",this._canvas.style.top=this._position.y+"px"}_captureIsActive(){return document.captureElement&&document.documentElement.contains(document.captureElement)}}
//# sourceMappingURL=/sm/dacda497f9b2d726897308ecd041bfad13d6b572245bf57b4e54fb94b688c88a.map