/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/@novnc/novnc@1.6.0/lib/input/keyboard.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Log=_interopRequireWildcard(require("../util/logging.js")),_events=require("../util/events.js"),KeyboardUtil=_interopRequireWildcard(require("./util.js")),_keysym=_interopRequireDefault(require("./keysym.js")),browser=_interopRequireWildcard(require("../util/browser.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(_getRequireWildcardCache=function(e){return e?i:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};var i=_getRequireWildcardCache(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&{}.hasOwnProperty.call(e,s)){var o=n?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Keyboard=exports.default=function(){return _createClass((function e(t){_classCallCheck(this,e),this._target=t||null,this._keyDownList={},this._altGrArmed=!1,this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),blur:this._allKeysUp.bind(this)},this.onkeyevent=function(){}}),[{key:"_sendKeyEvent",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(i)this._keyDownList[t]=e;else{if(!(t in this._keyDownList))return;delete this._keyDownList[t]}Log.Debug("onkeyevent "+(i?"down":"up")+", keysym: "+e,", code: "+t+", numlock: "+r+", capslock: "+n),this.onkeyevent(e,t,i,r,n)}},{key:"_getKeyCode",value:function(e){var t=KeyboardUtil.getKeycode(e);if("Unidentified"!==t)return t;if(e.keyCode&&229!==e.keyCode)return"Platform"+e.keyCode;if(e.keyIdentifier){if("U+"!==e.keyIdentifier.substr(0,2))return e.keyIdentifier;var i=parseInt(e.keyIdentifier.substr(2),16);return"Platform"+String.fromCharCode(i).toUpperCase().charCodeAt()}return"Unidentified"}},{key:"_handleKeyDown",value:function(e){var t=this._getKeyCode(e),i=KeyboardUtil.getKeysym(e),r=e.getModifierState("NumLock"),n=e.getModifierState("CapsLock");if((browser.isMac()||browser.isIOS())&&(r=null),this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),"AltRight"===t&&e.timeStamp-this._altGrCtrlTime<50?i=_keysym.default.XK_ISO_Level3_Shift:this._sendKeyEvent(_keysym.default.XK_Control_L,"ControlLeft",!0,r,n)),"Unidentified"===t)return i&&(this._sendKeyEvent(i,t,!0,r,n),this._sendKeyEvent(i,t,!1,r,n)),void(0,_events.stopEvent)(e);if(browser.isMac()||browser.isIOS())switch(i){case _keysym.default.XK_Super_L:i=_keysym.default.XK_Alt_L;break;case _keysym.default.XK_Super_R:i=_keysym.default.XK_Super_L;break;case _keysym.default.XK_Alt_L:i=_keysym.default.XK_Mode_switch;break;case _keysym.default.XK_Alt_R:i=_keysym.default.XK_ISO_Level3_Shift}if(t in this._keyDownList&&(i=this._keyDownList[t]),(browser.isMac()||browser.isIOS())&&e.metaKey&&"MetaLeft"!==t&&"MetaRight"!==t)return this._sendKeyEvent(i,t,!0,r,n),this._sendKeyEvent(i,t,!1,r,n),void(0,_events.stopEvent)(e);if((browser.isMac()||browser.isIOS())&&"CapsLock"===t)return this._sendKeyEvent(_keysym.default.XK_Caps_Lock,"CapsLock",!0,r,n),this._sendKeyEvent(_keysym.default.XK_Caps_Lock,"CapsLock",!1,r,n),void(0,_events.stopEvent)(e);var s=[_keysym.default.XK_Zenkaku_Hankaku,_keysym.default.XK_Eisu_toggle,_keysym.default.XK_Katakana,_keysym.default.XK_Hiragana,_keysym.default.XK_Romaji];return browser.isWindows()&&s.includes(i)?(this._sendKeyEvent(i,t,!0,r,n),this._sendKeyEvent(i,t,!1,r,n),void(0,_events.stopEvent)(e)):((0,_events.stopEvent)(e),"ControlLeft"===t&&browser.isWindows()&&!("ControlLeft"in this._keyDownList)?(this._altGrArmed=!0,this._altGrTimeout=setTimeout(this._interruptAltGrSequence.bind(this),100),void(this._altGrCtrlTime=e.timeStamp)):void this._sendKeyEvent(i,t,!0,r,n))}},{key:"_handleKeyUp",value:function(e){(0,_events.stopEvent)(e);var t=this._getKeyCode(e);if(this._interruptAltGrSequence(),(browser.isMac()||browser.isIOS())&&"CapsLock"===t)return this._sendKeyEvent(_keysym.default.XK_Caps_Lock,"CapsLock",!0),void this._sendKeyEvent(_keysym.default.XK_Caps_Lock,"CapsLock",!1);this._sendKeyEvent(this._keyDownList[t],t,!1),!browser.isWindows()||"ShiftLeft"!==t&&"ShiftRight"!==t||("ShiftRight"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftRight,"ShiftRight",!1),"ShiftLeft"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftLeft,"ShiftLeft",!1))}},{key:"_interruptAltGrSequence",value:function(){this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(_keysym.default.XK_Control_L,"ControlLeft",!0))}},{key:"_allKeysUp",value:function(){for(var e in Log.Debug(">> Keyboard.allKeysUp"),this._interruptAltGrSequence(),this._keyDownList)this._sendKeyEvent(this._keyDownList[e],e,!1);Log.Debug("<< Keyboard.allKeysUp")}},{key:"grab",value:function(){this._target.addEventListener("keydown",this._eventHandlers.keydown),this._target.addEventListener("keyup",this._eventHandlers.keyup),window.addEventListener("blur",this._eventHandlers.blur)}},{key:"ungrab",value:function(){this._target.removeEventListener("keydown",this._eventHandlers.keydown),this._target.removeEventListener("keyup",this._eventHandlers.keyup),window.removeEventListener("blur",this._eventHandlers.blur),this._allKeysUp()}}])}();
//# sourceMappingURL=/sm/42596945c941eced08d5df530f6675c3a7a4216529dc80f303cf6a69c330cc6a.map