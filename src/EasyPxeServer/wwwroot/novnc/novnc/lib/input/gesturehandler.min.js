/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/@novnc/novnc@1.6.0/lib/input/gesturehandler.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var GH_NOGESTURE=0,GH_ONETAP=1,GH_TWOTAP=2,GH_THREETAP=4,GH_DRAG=8,GH_LONGPRESS=16,GH_TWODRAG=32,GH_PINCH=64,GH_INITSTATE=127,GH_MOVE_THRESHOLD=50,GH_ANGLE_THRESHOLD=90,GH_MULTITOUCH_TIMEOUT=250,GH_TAP_TIMEOUT=1e3,GH_LONGPRESS_TIMEOUT=1e3,GH_TWOTOUCH_TIMEOUT=50,GestureHandler=exports.default=function(){return _createClass((function t(){_classCallCheck(this,t),this._target=null,this._state=GH_INITSTATE,this._tracked=[],this._ignored=[],this._waitingRelease=!1,this._releaseStart=0,this._longpressTimeoutId=null,this._twoTouchTimeoutId=null,this._boundEventHandler=this._eventHandler.bind(this)}),[{key:"attach",value:function(t){this.detach(),this._target=t,this._target.addEventListener("touchstart",this._boundEventHandler),this._target.addEventListener("touchmove",this._boundEventHandler),this._target.addEventListener("touchend",this._boundEventHandler),this._target.addEventListener("touchcancel",this._boundEventHandler)}},{key:"detach",value:function(){this._target&&(this._stopLongpressTimeout(),this._stopTwoTouchTimeout(),this._target.removeEventListener("touchstart",this._boundEventHandler),this._target.removeEventListener("touchmove",this._boundEventHandler),this._target.removeEventListener("touchend",this._boundEventHandler),this._target.removeEventListener("touchcancel",this._boundEventHandler),this._target=null)}},{key:"_eventHandler",value:function(t){var e;switch(t.stopPropagation(),t.preventDefault(),t.type){case"touchstart":e=this._touchStart;break;case"touchmove":e=this._touchMove;break;case"touchend":case"touchcancel":e=this._touchEnd}for(var s=0;s<t.changedTouches.length;s++){var i=t.changedTouches[s];e.call(this,i.identifier,i.clientX,i.clientY)}}},{key:"_touchStart",value:function(t,e,s){if(this._hasDetectedGesture()||this._state===GH_NOGESTURE)this._ignored.push(t);else{if(this._tracked.length>0&&Date.now()-this._tracked[0].started>GH_MULTITOUCH_TIMEOUT)return this._state=GH_NOGESTURE,void this._ignored.push(t);if(this._waitingRelease)return this._state=GH_NOGESTURE,void this._ignored.push(t);switch(this._tracked.push({id:t,started:Date.now(),active:!0,firstX:e,firstY:s,lastX:e,lastY:s,angle:0}),this._tracked.length){case 1:this._startLongpressTimeout();break;case 2:this._state&=~(GH_ONETAP|GH_DRAG|GH_LONGPRESS),this._stopLongpressTimeout();break;case 3:this._state&=~(GH_TWOTAP|GH_TWODRAG|GH_PINCH);break;default:this._state=GH_NOGESTURE}}}},{key:"_touchMove",value:function(t,e,s){var i=this._tracked.find((function(e){return e.id===t}));if(void 0!==i){i.lastX=e,i.lastY=s;var r=e-i.firstX,a=s-i.firstY;if(i.firstX===i.lastX&&i.firstY===i.lastY||(i.angle=180*Math.atan2(a,r)/Math.PI),!this._hasDetectedGesture()){if(Math.hypot(r,a)<GH_MOVE_THRESHOLD)return;if(this._state&=~(GH_ONETAP|GH_TWOTAP|GH_THREETAP|GH_LONGPRESS),this._stopLongpressTimeout(),1!==this._tracked.length&&(this._state&=~GH_DRAG),2!==this._tracked.length&&(this._state&=~(GH_TWODRAG|GH_PINCH)),2===this._tracked.length){var n=this._tracked.find((function(e){return e.id!==t}));if(Math.hypot(n.firstX-n.lastX,n.firstY-n.lastY)>GH_MOVE_THRESHOLD){var o=Math.abs(i.angle-n.angle);o=Math.abs((o+180)%360-180),this._state&=o>GH_ANGLE_THRESHOLD?~GH_TWODRAG:~GH_PINCH,this._isTwoTouchTimeoutRunning()&&this._stopTwoTouchTimeout()}else this._isTwoTouchTimeoutRunning()||this._startTwoTouchTimeout()}if(!this._hasDetectedGesture())return;this._pushEvent("gesturestart")}this._pushEvent("gesturemove")}}},{key:"_touchEnd",value:function(t,e,s){if(-1!==this._ignored.indexOf(t))return this._ignored.splice(this._ignored.indexOf(t),1),void(0===this._ignored.length&&0===this._tracked.length&&(this._state=GH_INITSTATE,this._waitingRelease=!1));if(!this._hasDetectedGesture()&&this._isTwoTouchTimeoutRunning()&&(this._stopTwoTouchTimeout(),this._state=GH_NOGESTURE),!this._hasDetectedGesture()&&(this._state&=~(GH_DRAG|GH_TWODRAG|GH_PINCH),this._state&=~GH_LONGPRESS,this._stopLongpressTimeout(),!this._waitingRelease))switch(this._releaseStart=Date.now(),this._waitingRelease=!0,this._tracked.length){case 1:this._state&=~(GH_TWOTAP|GH_THREETAP);break;case 2:this._state&=~(GH_ONETAP|GH_THREETAP)}if(this._waitingRelease)if(Date.now()-this._releaseStart>GH_MULTITOUCH_TIMEOUT&&(this._state=GH_NOGESTURE),this._tracked.some((function(t){return Date.now()-t.started>GH_TAP_TIMEOUT}))&&(this._state=GH_NOGESTURE),this._tracked.find((function(e){return e.id===t})).active=!1,this._hasDetectedGesture())this._pushEvent("gesturestart");else if(this._state!==GH_NOGESTURE)return;this._hasDetectedGesture()&&this._pushEvent("gestureend");for(var i=0;i<this._tracked.length;i++)this._tracked[i].active&&this._ignored.push(this._tracked[i].id);this._tracked=[],this._state=GH_NOGESTURE,-1!==this._ignored.indexOf(t)&&this._ignored.splice(this._ignored.indexOf(t),1),0===this._ignored.length&&(this._state=GH_INITSTATE,this._waitingRelease=!1)}},{key:"_hasDetectedGesture",value:function(){return this._state!==GH_NOGESTURE&&(!(this._state&this._state-1)&&!(this._state&(GH_ONETAP|GH_TWOTAP|GH_THREETAP)&&this._tracked.some((function(t){return t.active}))))}},{key:"_startLongpressTimeout",value:function(){var t=this;this._stopLongpressTimeout(),this._longpressTimeoutId=setTimeout((function(){return t._longpressTimeout()}),GH_LONGPRESS_TIMEOUT)}},{key:"_stopLongpressTimeout",value:function(){clearTimeout(this._longpressTimeoutId),this._longpressTimeoutId=null}},{key:"_longpressTimeout",value:function(){if(this._hasDetectedGesture())throw new Error("A longpress gesture failed, conflict with a different gesture");this._state=GH_LONGPRESS,this._pushEvent("gesturestart")}},{key:"_startTwoTouchTimeout",value:function(){var t=this;this._stopTwoTouchTimeout(),this._twoTouchTimeoutId=setTimeout((function(){return t._twoTouchTimeout()}),GH_TWOTOUCH_TIMEOUT)}},{key:"_stopTwoTouchTimeout",value:function(){clearTimeout(this._twoTouchTimeoutId),this._twoTouchTimeoutId=null}},{key:"_isTwoTouchTimeoutRunning",value:function(){return null!==this._twoTouchTimeoutId}},{key:"_twoTouchTimeout",value:function(){if(0===this._tracked.length)throw new Error("A pinch or two drag gesture failed, no tracked touches");var t=this._getAverageMovement(),e=Math.abs(t.x),s=Math.abs(t.y),i=this._getAverageDistance(),r=Math.abs(Math.hypot(i.first.x,i.first.y)-Math.hypot(i.last.x,i.last.y));this._state=s<r&&e<r?GH_PINCH:GH_TWODRAG,this._pushEvent("gesturestart"),this._pushEvent("gesturemove")}},{key:"_pushEvent",value:function(t){var e={type:this._stateToGesture(this._state)},s=this._getPosition(),i=s.last;switch("gesturestart"===t&&(i=s.first),this._state){case GH_TWODRAG:case GH_PINCH:i=s.first}if(e.clientX=i.x,e.clientY=i.y,this._state===GH_PINCH){var r=this._getAverageDistance();"gesturestart"===t?(e.magnitudeX=r.first.x,e.magnitudeY=r.first.y):(e.magnitudeX=r.last.x,e.magnitudeY=r.last.y)}else if(this._state===GH_TWODRAG)if("gesturestart"===t)e.magnitudeX=0,e.magnitudeY=0;else{var a=this._getAverageMovement();e.magnitudeX=a.x,e.magnitudeY=a.y}var n=new CustomEvent(t,{detail:e});this._target.dispatchEvent(n)}},{key:"_stateToGesture",value:function(t){switch(t){case GH_ONETAP:return"onetap";case GH_TWOTAP:return"twotap";case GH_THREETAP:return"threetap";case GH_DRAG:return"drag";case GH_LONGPRESS:return"longpress";case GH_TWODRAG:return"twodrag";case GH_PINCH:return"pinch"}throw new Error("Unknown gesture state: "+t)}},{key:"_getPosition",value:function(){if(0===this._tracked.length)throw new Error("Failed to get gesture position, no tracked touches");for(var t=this._tracked.length,e=0,s=0,i=0,r=0,a=0;a<this._tracked.length;a++)e+=this._tracked[a].firstX,s+=this._tracked[a].firstY,i+=this._tracked[a].lastX,r+=this._tracked[a].lastY;return{first:{x:e/t,y:s/t},last:{x:i/t,y:r/t}}}},{key:"_getAverageMovement",value:function(){if(0===this._tracked.length)throw new Error("Failed to get gesture movement, no tracked touches");var t,e;t=e=0;for(var s=this._tracked.length,i=0;i<this._tracked.length;i++)t+=this._tracked[i].lastX-this._tracked[i].firstX,e+=this._tracked[i].lastY-this._tracked[i].firstY;return{x:t/s,y:e/s}}},{key:"_getAverageDistance",value:function(){if(0===this._tracked.length)throw new Error("Failed to get gesture distance, no tracked touches");var t=this._tracked[0],e=this._tracked[this._tracked.length-1];return{first:{x:Math.abs(e.firstX-t.firstX),y:Math.abs(e.firstY-t.firstY)},last:{x:Math.abs(e.lastX-t.lastX),y:Math.abs(e.lastY-t.lastY)}}}}])}();
//# sourceMappingURL=/sm/5bb6d74ebc7ff0810120606bb59f84055f3277411683831b294f550dd5d7997e.map