@using EasyPxeServer.Services
@using MarcusW.VncClient

@namespace EasyPxeServer.Components

@if (Connection is not { ConnectionState: ConnectionState.Connected })
{
    <div class="vnc-placeholder">
        <p>@(Connection == null ? "请选择一个VNC会话" : "连接已断开")</p>
    </div>
}
else
{
    <div class="vnc-canvas-container">
        <VncView @ref="_vncView" Connection="Connection"/>
    </div>
}

@code {

    [Parameter]
    public RfbConnection? Connection { get; set; }

    [Parameter]
    public EventCallback<Exception> OnConnectionError { get; set; }

    [Parameter]
    public EventCallback OnConnectionClosed { get; set; }

    private MouseButton _currentMouseButtons = MouseButton.None;

    private VncView? _vncView;

    // 组件初始化时添加连接事件监听
    protected override void OnInitialized() { }

    // 当连接属性变化时更新事件监听
    protected override void OnParametersSet()
    {
        // 这里可以添加连接变化的处理逻辑
    }

    // 处理连接错误事件
    private async void OnConnectionErrorHandler(Exception ex) { await OnConnectionError.InvokeAsync(ex); }

    // 处理连接关闭事件
    private async void OnConnectionClosedHandler() { await OnConnectionClosed.InvokeAsync(null); }

    // 组件销毁时移除事件监听
    public void Dispose() { }
}

<style>
    .vnc-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        background-color: #f5f5f5;
        color: #666;
        font-size: 16px;
    }

    .vnc-canvas-container {
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .vnc-canvas {
        width: 100%;
        height: 100%;
        cursor: crosshair;
    }

    .vnc-display {
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0),
                    linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0);
        background-size: 20px 20px;
        background-position: 0 0, 10px 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .vnc-status {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 12px;
    }

    .vnc-placeholder-text {
        text-align: center;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .vnc-placeholder-text p {
        margin: 5px 0;
    }
</style>